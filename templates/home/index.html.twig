{% extends 'base.html.twig' %}

{% block title %}Home{% endblock %}

{% block body %}

<section class="home">

    {% if app.user %}
        
        <div class="subscriptions">

            <div class="avatar">

                {% for artist in artists %}
                
                    <figure>
        
                        <a href="{{path('app_artistDetail', {'id': artist.username})}}">
                        
                            <img class=" rounded-circle w-100" src="{{asset('/uploads/' ~ artist.avatar)}}" alt="{{artist.username}} profile picture">
                        </a>
                    </figure>
                {% endfor %}

            </div>

        </div>
    {% endif %}


    <div class="hero">

        <div class="parallax">

            <figure>
                <img src="{{asset('uploads/' ~ artist.poster)}}" alt="{{artist.username}} introduction">
            </figure>
    
            <figcaption>
                <h1>Discover {{artist.username}} the Hottest artist of the moment !</h1>
    
                <p>{{ artist.bio|length > 242 ? artist.bio|slice(0, 242) ~ '...' : artist.bio  }} </p>
    
                <a href="{{path('app_artistDetail', {'id': artist.username})}}">Listen Now !</a>
            </figcaption>
        </div>

    </div>


    <div class="playlist">

        <div class="title">

            <h1>Recommended</h1>
            <a href="{{path('more_recommended')}}">More</a>
        </div>

        <div class="playlistCards">

            {% for playlist in playlists %}
                
                <div class="playlistCard">
                    <a href="{{path('playlist_detail', {'id' : playlist.uuid})}}">
                        
                        <figure>
                            {% if playlist.image == null %}
                                <img src="{{asset('img/dee-XhvEvfXQoSY-unsplash.jpg')}}" alt="playlist image">
                            {% else %}
                                <img src="{{asset('uploads/' ~ playlist.image)}}" alt="playlist image">
                            {% endif %}
                        </figure>
                        
                        <h3>{{playlist.playlistName}}</h3>
                    </a>
                </div>
            {% endfor %}

        </div>

    </div>

    {# if the user is connected and has a favorite playlist #}
    {% if (app.user) and (favoritePlaylists != null) %}

        <div class="playlist">

            <div class="title">

                <h1>Your Favorite Playlists</h1>
                <a href="{{path('app_favorites')}}">More</a>
            </div>

            <div class="playlistCards">
                
    
                {% for favorite in app.user.favoritePlaylists %}
                    
                    <div class="playlistCard">

                        <a href="{{path('playlist_detail', {'id' : favorite.uuid})}}">
                            <figure>

                                {% if favorite.image != null %}
                                    
                                    <img src="{{asset('uploads/' ~ favorite.image)}}" alt="playlist image">

                                {% else %}

                                    <img src="{{asset('img/dee-XhvEvfXQoSY-unsplash.jpg')}}" alt="playlist image">
                                {% endif %}
                                
                            </figure>

                            <h3>{{favorite.playlistName}}</h3>

                        </a>
                    </div>
                {% endfor %}

            </div>

        </div>

    {% endif %}


    <div class="song">

        <div class="title">

            <h1>Most liked songs</h1>
            <a href="{{path('app_mostLiked')}}">More</a>
        </div>

        <div class="songCards">

            {% if songs|length %}
            {% set songsCol = (songs|length / 3)|round(0, 'floor') %}

            {% for song in songs %}     
            
                {% if songsCol == 1 or loop.index % songsCol == 1 %}
                    <div class="side">

                {% endif %}

                    <div class="songCard">
                        
                        <a href="{{path('app_songPlayer', {'id': song.uuid})}}"  class="musicLink">
                            
                            <figure>
                                <img src="{{asset('uploads/' ~ song.cover)}}" alt="playlist image">
                            </figure>
                            
                            <h3>{{song.nameSong}} </h3>

                            
                        </a>

                        <a href="{{path('form_toSongsPlaylist', {'id': song.id})}} " class="fa-solid fa-ellipsis" target="_blank"></a>
                        
                    </div>

                {% if loop.last or loop.index % songsCol == 0 %}
                    </div>
                {% endif %}
            {% endfor %}
        {% endif %}             
            
        </div>
    </div>


    {% if app.user %}
        
        <div class="playlist">

            <div class="title">

                <h1>Albums based on your subscriptions </h1>
                <a href="{{path('app_favorites')}}">More</a>
            </div>

            <div class="playlistCards">
                

                {% for album in subscriptionAlbums %}
                    
                    <div class="playlistCard">

                        <a href="{{path('app_albumDetail', {'id' : album.uuid})}}">
                            <figure>

                                {% if album.cover != null %}
                                    
                                    <img src="{{asset('uploads/' ~ album.cover)}}" alt="playlist image">

                                {% else %}

                                    <img src="{{asset('img/dee-XhvEvfXQoSY-unsplash.jpg')}}" alt="playlist image">
                                {% endif %}
                                
                            </figure>

                            <h3>{{album.nameAlbum}}</h3>

                        </a>
                    </div>
                {% endfor %}

            </div>

        </div>


        <div class="song">

            <div class="title">

                <h1>Just for You !</h1>
                <a href="{{path('app_mostLiked')}}">More</a>
            </div>

            <div class="songCards">

                {% if subscriptionSongs|length %}
                    {% set songsCol = (subscriptionSongs|length / 3)|round(0, 'floor') %}

                    {% for song in subscriptionSongs %}     
                    
                        {% if songsCol == 1 or loop.index % songsCol == 1 %}
                            <div class="side">

                        {% endif %}

                            <div class="songCard">
                                

                                <a href="{{path('app_songPlayer', {'id': song.uuid})}}" class="musicLink">
                                    
                                    <figure>
                                        <img src="{{asset('uploads/' ~ song.cover)}}" alt="playlist image">
                                    </figure>
                                    
                                    <h3>{{song.nameSong}} </h3>

                                </a>

                                <a href="{{path('form_toSongsPlaylist', {'id': song.id})}} " class="fa-solid fa-ellipsis" target="_blank"></a>
                            
                                
                            </div>

                        {% if loop.last or loop.index % songsCol == 0 %}
                            </div>
                        {% endif %}
                    {% endfor %}
                {% endif %}                 
                
                
            </div>

        </div>
    {% endif %}


</section>
{% endblock %}